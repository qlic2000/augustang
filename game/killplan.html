<!doctype html>
<!-- 简易骨架：后续在 script 中实现游戏逻辑 -->
<html>
<head>
  <meta charset="utf-8">
  <title>坦克打飞机</title>
  <style>canvas{display:block;background:#000}</style>
</head>
<body>
  <canvas id="game"></canvas>
  <script>
    // ...existing code...
    // 初始化 canvas、资源加载、游戏循环的起点
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    // 这里可以添加更多的游戏逻辑代码
    // 定义坦克、飞机、子弹的类，处理用户输入，更新游戏状态，渲染图形
    class Tank {
      constructor(x, y) {
        this.x = x;
        this.y = y;
        // 其他属性如速度、方向等
      }
      draw() {
        ctx.fillStyle = 'green';
        ctx.fillRect(this.x, this.y, 50, 30); // 简单表示坦克
      }
      // 使用wsad来控制坦克上下左右移动
      move(direction) {
        const speed = 10;
        switch(direction) {
          case 'w': this.y -= speed; break;
          case 's': this.y += speed; break;
          case 'a': this.x -= speed; break;
          case 'd': this.x += speed; break;
        }
      } 
   //顶端向下出现一些飞机
      shoot() {
        // 按数字0发射子弹
        bullets.push(new Bullet(this.x + 22.5, this.y)); 
      }
    }
    class Plane {
      constructor(x, y) {
        this.x = x;
        this.y = y;
        // 其他属性如速度等
      }
      draw() {
        ctx.fillStyle = 'red';
        ctx.fillRect(this.x, this.y, 40, 20); // 简单表示飞机
      }
      update() {
        this.y += 2; // 飞机向下移动
      }
    }

    class Bullet {
      constructor(x, y) {
        this.x = x;
        this.y = y;
        // 其他属性如速度等
      }
      draw() {
        ctx.fillStyle = 'yellow';
        ctx.fillRect(this.x, this.y, 5, 10); // 简单表示子弹
      }
      update() {
        this.y -= 5; // 子弹向上移动
      }
    }

    const tank = new Tank(canvas.width / 2, canvas.height - 50);
    const planes = [];
    const bullets = [];
  let score = 0;

    function gameLoop() {
      // 更新逻辑：先清屏
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // 绘制分数在左上角
      ctx.fillStyle = 'white';
      ctx.font = '20px sans-serif';
      ctx.fillText('分数: ' + score, 10, 24);

      // 更新飞机（从后向前以便安全删除）
      for (let i = planes.length - 1; i >= 0; i--) {
        planes[i].update();
      }

      // 更新子弹并移除飞出屏幕的子弹
      for (let i = bullets.length - 1; i >= 0; i--) {
        bullets[i].update();
        // 子弹高度为10：当完全飞出画布顶部时移除
        if (bullets[i].y + 10 < 0) {
          bullets.splice(i, 1);
        }
      }

      // 碰撞检测（会移除被击中的子弹和飞机）
      checkCollisions();

      // 移除飞出画布底部的飞机
      for (let i = planes.length - 1; i >= 0; i--) {
        if (planes[i].y > canvas.height) {
          planes.splice(i, 1);
        }
      }

      // 绘制顺序：坦克 -> 飞机 -> 子弹
      tank.draw();
      planes.forEach(plane => plane.draw());
      bullets.forEach(bullet => bullet.draw());

      requestAnimationFrame(gameLoop);
    }

    gameLoop();

    window.addEventListener('keydown', (e) => {
      if (['w', 'a', 's', 'd'].includes(e.key)) {
        tank.move(e.key);
      } else if (e.key === '0') {
        tank.shoot();
      }
    });

    // 定时生成飞机
    setInterval(() => {
      const x = Math.random() * (canvas.width - 40);
      planes.push(new Plane(x, 0));
    }, 2000);   
    // （旧）碰撞检测逻辑已移除；保留下面带胜利判定的实现
// 打中一架飞机加1分，到达10分获胜
    function checkCollisions() {
      for (let i = bullets.length - 1; i >= 0; i--) {
        for (let j = planes.length - 1; j >= 0; j--) {
          if (bullets[i].x < planes[j].x + 40 &&
              bullets[i].x + 5 > planes[j].x &&
              bullets[i].y < planes[j].y + 20 &&
              bullets[i].y + 10 > planes[j].y) {
            // 碰撞检测
            bullets.splice(i, 1);
            planes.splice(j, 1);
            score++;
            if (score >= 5) {
              alert('你赢了！');
              score = 0; // 重置分数
            }
            break;
          }
        }
      }
    } 
    </script>
</body>
</html>
